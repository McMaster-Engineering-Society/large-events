upstream gateway {
    server gateway:3000;
}

upstream team_a_api {
    server team-a-api:3001;
}

upstream team_b_api {
    server team-b-api:3002;
}

upstream team_c_api {
    server team-c-api:3003;
}

upstream team_d_api {
    server team-d-api:3004;
}

upstream team_a_web_user {
    server team-a-web-user:3011;
}

upstream team_a_web_admin {
    server team-a-web-admin:3021;
}

upstream team_b_web_user {
    server team-b-web-user:3012;
}

upstream team_b_web_admin {
    server team-b-web-admin:3022;
}

upstream team_c_web_user {
    server team-c-web-user:3013;
}

upstream team_c_web_admin {
    server team-c-web-admin:3023;
}

upstream team_d_web_user {
    server team-d-web-user:3014;
}

upstream team_d_web_admin {
    server team-d-web-admin:3024;
}

server {
    listen 80;
    server_name localhost;

    # API Gateway
    location /api/ {
        proxy_pass http://gateway;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }

    # Team A User Web App
    location /teamA/user/ {
        proxy_pass http://team_a_web_user/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Team A Admin Web App
    location /teamA/admin/ {
        proxy_pass http://team_a_web_admin/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Team B User Web App
    location /teamB/user/ {
        proxy_pass http://team_b_web_user/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Team B Admin Web App
    location /teamB/admin/ {
        proxy_pass http://team_b_web_admin/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Team C User Web App
    location /teamC/user/ {
        proxy_pass http://team_c_web_user/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Team C Admin Web App
    location /teamC/admin/ {
        proxy_pass http://team_c_web_admin/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Team D User Web App
    location /teamD/user/ {
        proxy_pass http://team_d_web_user/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Team D Admin Web App
    location /teamD/admin/ {
        proxy_pass http://team_d_web_admin/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Default route to gateway documentation
    location / {
        proxy_pass http://gateway;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Health check
    location /health {
        proxy_pass http://gateway/health;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}